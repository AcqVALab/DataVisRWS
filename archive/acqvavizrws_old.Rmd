---
title: "Introduction to Data Visualization with R - AcqVA Aurora workshop"
author: "Martin Schweinberger"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output:
  bookdown::html_document2: 
bibliography: bibliography.bib
link-citations: yes
---


```{r uq1, echo=F, fig.cap="", message=FALSE, warning=FALSE, out.width='100%'}
knitr::include_graphics("https://slcladal.github.io/images/acqvalab.png")
```


# Introduction{-}

This tutorial introduces data visualization using R with the aim of showcasing how to visualize data and how to adapt, change, and modify visualizations using the `ggplot2`  [@ggplot2], the `vcd` [@vcd, @mosaic], and the `likert`packages [@likert]. 

This tutorial is aimed at beginners and intermediate users of R. 


The aim is not to provide a fully-fledged guide but rather to show and exemplify some common methods in data visualization such as how to produce different types of visualizations, how to adapt the style of visualizations, and how to modify the look and content of the visualizations in R.


<div class="warning" style='padding:0.1em; background-color:#f2f2f2; color:#51247a'>
<span>
<p style='margin-top:1em; text-align:center'>
The entire R Notebook for the tutorial can be downloaded [**here**](https://github.com/MartinSchweinberger/AcqVA_DataVisR_WS/introviz.Rmd).  If you want to render the R Notebook on your machine, i.e. knitting the document to html or a pdf, you need to make sure that you have R and RStudio installed and you also need to download the [**bibliography file**](https://github.com/MartinSchweinberger/AcqVA_DataVisR_WS/bibliography.bib) and store it in the same folder where you store the Rproj file. <br><br>
**[Here](https://colab.research.google.com/drive/1Ty2jK_JZo9hANAWXg-d_PRV8dKVx4P51?usp=sharing)** is a **link to an interactive version of this tutorial on Google Colab**. The interactive tutorial is based on a Jupyter notebook of this tutorial. This interactive Jupyter notebook allows you to execute code yourself and - if you copy the Jupyter notebook - you can also change and edit the notebook, e.g. you can change code and upload your own data.<br></p>
<p style='margin-left:1em;'>
</p></span>
</div>

<br>



## What to do before the workshop{-}

To get the most out of this workshop, you will need to have some (basic) R skills and (basic) knowledge of how to work with R, RStudio, R Projects, and R Notebooks. If you have no or little experience with this or if you need to refresh your skills, please carefully read (or optimally go through) these tutorials:

* [Getting started with R](https://slcladal.github.io/intror.html)

* [Handling tables in R](https://slcladal.github.io/table.html)

Before attending the workshop, you need to install the following packages in RStudio:

* `ggplot2`  (for general data visualization)

* `here` (for easy pathing)

* `tidyverse` (for data processing)

* `vcd` (for mosaic plots)

* `likert` (for visualizing Likert data)

* `knitr` (for knitting R Notebooks)

* `markdown` (for rendering Rmd files)

* `rmarkdown`  (for R Markdown formatting)

* `installr` (for updating R)

* `gridExtra` for multiple plots in one window



You can install these packages by clicking on `packages` on the top of the lower right pane in RStudio or you can execute the following code in the lower left, `Console` pane of RStudio. 

```{r install, eval = F, message=F, warning=F}
# update R
#install.packages("installr")
#library(installr)
#updateR()
# install required packages
install.packages(c("tidyverse", "here", "vcd", "likert", "knitr", 
                   "markdown", "rmarkdown", "gridExtra", "lme4", 
                   "sjPlot"), 
                 dependencies = T)
```


**It is really important that you have knowledge of R and RStudio and that you have installed the packages before the workshop so that we do not have to deal with technical issues too much.**

You can find a more detailed version of the content of this workshop in these two tutorials

* [Introduction to Data Visualization in R](https://slcladal.github.io/introviz.html)

* [Data Visualization with R](https://slcladal.github.io/dviz.html)

You can follow this workshop in different ways but the intention for it is to be practical so that I show something and then you do it on you computer. In addition, we will have exercises where you can try out what you have just learned.

## Timeline{-}


We will go through the following steps:

Tuesday, January 25, 10-12am

* Introduction

* Primer

* Session preparation

* How to load different data formats into R

* Basics of data preparation 

* Getting started with ggplot2

* Modifying plots

Tuesday, January 25, 1-3pm

* More on modifying plots

* Mosaic plots with vcd

* Visualizing Likert data

* Visulaizing effects of mixed-effect models 

* Wrap-up

## About this workshop{-}

You can follow this workshop in different ways:

1. You can sit back and enjoy and focus on what you see and then go back home and try it by yourself later.

2. You can follow this workshop in RStudio and execute code, see what it does, understand it, and adapt it. This requires some skills in R and RStudio - although I have trued to keep things simple.

3. You can click on [this link]() which takes you to a Jupyter Notebook on Google Colab (and you are then ready to go - you only  have to install the packages which takes a couple of minutes). You can then copy that Notebook and save it in your own Google Drive and then execute code, modify it, and understand it. This does require less skills and will be easier for people who just want to focus on the code that produces certain visualizations without doing it in RStudio. Also, this get rid of most technical issues (hopefully) but the installation of packages will take a while and you will need to re-install the packages every time you want to re-use the Jupyter Notebook.

Choose which option suits you best and then go with it. 

# Getting started{-}

If you choose option 2, you need to set up our R session and prepare our R project at the very beginning of the workshop. 

For everything to work, please do the following:

* Create a folder for this workshop somewhere on your computer, e.g. called *AcqVA_DataVisR_WS*

* In that folder, create two subfolders called *data* and *images*

* Open RStudio, go to File > New Project > Existing Directory (Browse to project folder) > Create (and hit Enter)

This will then create an R Project in the project folder.


## Primer{-}

We start by creating a super simple graph in base R just to get you going and showing you that creating graphs can be very easy.

So for your first graph, we will create some data and then visualize it - we do this in the following code chunk.

To execute the code, simply click on the *Play* button in the top right corner of the code box.

```{r primer, message=FALSE, warning=FALSE}
# generate two variables (x and y)
x <- sample(seq(0, 1, 0.01), 100) # draw a sample of 100 from numbers between 0 and 1
y <- rep(c("Group A", "Group B"), each = 50) # create a vector of 100 representing 2 groups
# create a box plot
boxplot(x ~ y, 
        col = c("orange", "lightblue"), # define colors of boxes
        xlab = "Groups",                # define x-axis label
        ylab = "Probability")           # define y-axis label
```

Yay! You created a nice boxplot in R. As you can see, generating graphs in R can be super simple.

And you can use base R to create graphs! In this tutorial, I want to show you how to generate graphs that are prettier but the code is also a bit more complex.

### Today's Data{-}


But first to the data,

we will use some data sets that Yulia and Isabel were kind enough to share with me. The publications associated with the data are:

The Accent data (already published): 

Kupisch, Tanja, Nadine Kolb, Yulia Rodina, and Olga Urek. 2021. Foreign Accent in Pre- and Primary School Heritage Bilinguals. *Languages* 6(2), 96; https://doi.org/10.3390/languages6020096

And the L2 English intervention data (which is still in progress):

Nygaard, Maren, Chistopher Loe Olsen, and Yulia Rodina. In progress. The effect of form-focused intervention on subject-verb agreement in L1 Norwegian L2 English learners.

In addition, we will use a data set that is part of the `likert` package and a data set that Isabel provided for the mixed-model effects visualization.

## Session preparation{-}

Now, we start by preparing the session. We do this by loading the packages we need as shown below.

```{r prep, message=F, warning=F}
# load packages
library(tidyverse)
library(here)
library(readxl)
library(vcd)
library(likert)
library(gridExtra)
library(lme4)
library(sjPlot)
```

Once you have executed the code 

# How to load different data formats into R{-}

Now, we want to load some data and we will see how to load 4 different types of data:

1. a Microsoft Excel file (xlsx)
2. a comma-separated file (csv)
3. a plain, tab-separated text file (txt)
4. an R data object (rda)

Let's load the data files and inspect the output. The data files should be in the data folder in the workshop project folder you created for this workshop.


## Load xlsx-file{-}

When we load data into R, we need to specify where R is supposed to load the file from. A handy way to do this is to use the `here` function (from  the a package also called `here`).

```{r loadxlsx, message=F, warning=F}
# load xlsx data
myxlsx <- readxl::read_xlsx(here::here("data", "data_german.xlsx"), sheet = 1)
# inspect data (the head function shows the first 6 rows of a table or data frame)
head(myxlsx)
```

The data set consists of 7 columns (*Date*, *Genre*, *Text*, *Prepositions*, *Region*, *GenreRedux*, *DateRedux*) representing the relative frequency of prepositions in texts written in England. The columns provide information about the texts with each row representing one of the texts.

## Load csv-file{-}

```{r loadcsv, message=F, warning=F}
# load csv file
mycsv <- read.csv(here::here("data", "data_german.csv"))
# inspect data
head(mycsv)
```

## Load txt-file{-}

```{r loadtxt, message=F, warning=F}
# load txt file
mytxt <- read.delim(here::here("data", "data_german.txt"), sep = "\t")
# inspect data
head(mytxt)
```


## Load rda-file{-}

```{r loadrda, message=F, warning=F}
# load xlsx data
myrda <- readRDS(here::here("data", "data_german.rda"))
# inspect data
head(myrda)
```

# Basics of data preparation{-}

Now that we have loaded the data, we will go over a few, very basic procedures for processing tabular data:

* `mutate`: creates new or changes existing columns

* `filter`: chooses rows based on given criteria

* `select`: chooses columns based on given criteria

* `group_by`: groups rows based on criteria in other columns

* `summarize`: summarizes column values

* `spread`: split values of a column and spread it across columns

* `gather`: take values of several columns and combine them into a single column 

* `%>%`: pipe-symbol that can be read as *and then*

These functions are important because you wil frequently have to change the data so that you can visualize it. We will try these function out below.

**Example**

```{r dpro1, eval = F, message=F, warning=F}
mytxt %>% # take the myxlsx data and then
  # create a new column called Preps that contains the frequencies of Preposition divided by 100 
  mutate(Preps = Prepositions/100) %>% # and then
  # only keep rows with Preps values higher than 1
  filter(Preps > 1) %>% # and then
  # only retain the columns Preps, DateRedux, and GenreRedux
  select(Preps, DateRedux, GenreRedux) -> newdata # store the results in an object called newdata
# inspect newdata
head(newdata)
```

We can also group and summarize the data now.

```{r dpro2, eval = F, message=F, warning=F}
newdata %>%
  group_by(GenreRedux, DateRedux) %>%
  summarise(N = n(),
            Preps = mean(Preps)) -> newdata2
# inspect
newdata2
```



Now, we have the number of observations and the mean frequency of Prepositions for each combination or *DateRedux* and *GenreRedux*.

```{r, eval = F, message=FALSE, warning=FALSE}
newdata2 %>%
  dplyr::mutate(DateRedux = as.factor(DateRedux)) %>%
  dplyr::group_by(DateRedux) %>%
  dplyr::summarise(Means = mean(Preps)) -> newdata3
# inspect
newdata3
```



# Getting started with ggplot2{-}

**About ggplot**

The *ggplot* environment was written by [Hadley Wickham](http://hadley.nz/) and it combines the positive aspects of both the *base* and the *lattice* packages. The *ggplot* environment implements a philosophy of graphic design described in builds on *The Grammar of Graphics* by Leland Wilkinson [@wilkinson2012grammar].

The philosophy of *ggplot2* is to consider graphics as consisting out of basic elements (called *aesthetics* and they include, for instance, the data set to be plotted and the axes) and layers that overlaid onto the aesthetics. The idea of the *ggplot2* package can be summarized as taking "care of many of the fiddly details that make plotting a hassle (like drawing legends) as well as providing a powerful model of graphics that makes it easy to produce complex multi-layered graphics."

Thus, ggplots typically start with the function call (`ggplot`) followed by the specification of the data, then the aesthetics (`aes`), and then a specification of the type of plot that is created (`geom_line` for line graphs, `geom_box` for box plots, `geom_bar` for bar graphs, `geom_text` for text, etc.). In addition, ggplot allows to specify all elements that the graph consists of (e.g. the theme and axes)


**We will now turn to creating the graphs**


When creating a visualization with ggplot, we first use the function `ggplot` and define the data that the visualization will use, then, we define the aesthetics which define the layout, i.e. the x- and y-axes. 

```{r plot1, message=FALSE, warning=FALSE}
ggplot(myxlsx, aes(x = accent_response, y = age_months))
```

## Box Plots{-}

In a next step, we add the geom-layer which defines the type of visualization that we want to display. In this case, we use `geom_boxplot` as we want to show boxes. Note that we add the geom-layer by adding a `+` at the end of the line!

```{r box01, message=FALSE, warning=FALSE}
ggplot(myxlsx, aes(x = accent_response, y = age_months)) +
  geom_boxplot()
```

### Saving plots{-}

We can use the `ggsave` function to save plots to your computer.

```{r saveplot, message=FALSE, warning=FALSE}
ggsave(here::here("images", "myfirstggplot.png"))
```


Another way of doing this: piping

Prettifying the plot

* Get rid of NAs

```{r box02, message=FALSE, warning=FALSE}
myxlsx %>%
  drop_na() %>%
ggplot(aes(x = accent_response, y = age_months)) +
  geom_boxplot()
```

* Reorder accent_response

```{r box03, message=FALSE, warning=FALSE}
myxlsx %>%
  drop_na() %>%
  mutate(accent_response = factor(accent_response, 
                                  levels = c("no", "w", "s"), 
                                  labels = c("No accent", "Weak accent", "Strong accent"))) %>%
ggplot(aes(x = accent_response, y = age_months)) +
  geom_boxplot()
```

* Changing axes-lables

```{r box04, message=FALSE, warning=FALSE}
myxlsx %>%
  drop_na() %>%
  mutate(accent_response = factor(accent_response, 
                                  levels = c("no", "w", "s"), 
                                  labels = c("No accent", "Weak accent", "Strong accent"))) %>%
ggplot(aes(x = accent_response, y = age_months)) +
  geom_boxplot() +
  labs(x = "Accent Rating",
       y = "Age (in months)")
```

* Add color

```{r box05, message=FALSE, warning=FALSE}
myxlsx %>%
  drop_na() %>%
  mutate(accent_response = factor(accent_response, 
                                  levels = c("no", "w", "s"), 
                                  labels = c("No accent", "Weak accent", "Strong accent"))) %>%
ggplot(aes(x = accent_response, y = age_months, fill = accent_response)) +
  geom_boxplot() +
  labs(x = "Accent Rating",
       y = "Age (in months)")
```

* Change background to white

```{r box06, message=FALSE, warning=FALSE}
myxlsx %>%
  drop_na() %>%
  mutate(accent_response = factor(accent_response, 
                                  levels = c("no", "w", "s"), 
                                  labels = c("No accent", "Weak accent", "Strong accent"))) %>%
ggplot(aes(x = accent_response, y = age_months, fill = accent_response)) +
  geom_boxplot() +
  labs(x = "Accent Rating",
       y = "Age (in months)") +
  theme_bw()
```

* Move legend to the top

```{r box07, message=FALSE, warning=FALSE}
myxlsx %>%
  drop_na() %>%
  mutate(accent_response = factor(accent_response, 
                                  levels = c("no", "w", "s"), 
                                  labels = c("No accent", "Weak accent", "Strong accent"))) %>%
ggplot(aes(x = accent_response, y = age_months, fill = accent_response)) +
  geom_boxplot() +
  labs(x = "Accent Rating",
       y = "Age (in months)") +
  theme_bw() +
  theme(legend.position = "top") +
  guides(fill=guide_legend(title="Levels of Accent"))
```

* Change axes limits

```{r box08, message=FALSE, warning=FALSE}
myxlsx %>%
  drop_na() %>%
  mutate(accent_response = factor(accent_response, 
                                  levels = c("no", "w", "s"), 
                                  labels = c("No accent", "Weak accent", "Strong accent"))) %>%
ggplot(aes(x = accent_response, y = age_months, fill = accent_response)) +
  geom_boxplot() +
  labs(x = "Accent Rating",
       y = "Age (in months)") +
  theme_bw() +
  theme(legend.position = "top") +
  guides(fill=guide_legend(title="Levels of Accent")) +
  coord_cartesian(x = c(0.5, 3.5),
                  y = c(0, 150))
```

* Change colors

```{r box09, message=FALSE, warning=FALSE}
myxlsx %>%
  drop_na() %>%
  mutate(accent_response = factor(accent_response, 
                                  levels = c("no", "w", "s"), 
                                  labels = c("No accent", "Weak accent", "Strong accent"))) %>%
ggplot(aes(x = accent_response, y = age_months, fill = accent_response)) +
  geom_boxplot() +
  labs(x = "Accent Rating",
       y = "Age (in months)") +
  theme_bw() +
  theme(legend.position = "top") +
  guides(fill=guide_legend(title="Levels of Accent")) +
  coord_cartesian(x = c(0.5, 3.5),
                  y = c(0, 150)) +
  scale_fill_manual(values = c("red", "blue", "gray"))
```


What if we want to include another factor?

```{r box10, message=FALSE, warning=FALSE}
myxlsx %>%
  drop_na() %>%
  mutate(accent_response = factor(accent_response, 
                                  levels = c("no", "w", "s"), 
                                  labels = c("No accent", "Weak accent", "Strong accent"))) %>%
ggplot(aes(x = accent_response, y = age_months, fill = accent_response)) +
  geom_boxplot() +
  labs(x = "Accent Rating",
       y = "Age (in months)") +
  theme_bw() +
  theme(legend.position = "top") +
  guides(fill=guide_legend(title="Levels of Accent")) +
  coord_cartesian(x = c(0.5, 3.5),
                  y = c(0, 150)) +
  scale_fill_manual(values = c("red", "blue", "gray"))  + 
  facet_grid(~family)
```

* Change direction of axes tick-marks

```{r box11, message=FALSE, warning=FALSE}
myxlsx %>%
  drop_na() %>%
  mutate(accent_response = factor(accent_response, 
                                  levels = c("no", "w", "s"), 
                                  labels = c("No accent", "Weak accent", "Strong accent"))) %>%
ggplot(aes(x = accent_response, y = age_months, fill = accent_response)) +
  geom_boxplot() +
  labs(x = "Accent Rating",
       y = "Age (in months)") +
  theme_bw() +
  theme(legend.position = "top",
        axis.text.x = element_text(size=8, angle=90)) +
  guides(fill=guide_legend(title="Levels of Accent")) +
  coord_cartesian(x = c(0.5, 3.5),
                  y = c(0, 150)) +
  scale_fill_manual(values = c("red", "blue", "gray"))  + 
  facet_grid(~family)
```

* Change header of legend


```{r box12, message=FALSE, warning=FALSE}
myxlsx %>%
  drop_na() %>%
  mutate(family = case_when(family == "bil-mixed" ~ "Mixed bilingual",
                            family == "bil-rus" ~ "Bilingual Russian",
                            family == "mono-de" ~ "Monolingual German",
                            TRUE ~ family),
         accent_response = factor(accent_response, 
                                  levels = c("no", "w", "s"), 
                                  labels = c("No accent", "Weak accent", "Strong accent"))) %>%
ggplot(aes(x = accent_response, y = age_months, fill = accent_response)) +
  geom_boxplot() +
  labs(x = "Accent Rating",
       y = "Age (in months)") +
  theme_bw() +
  theme(legend.position = "top",
        axis.text.x = element_text(size=8, angle=90)) +
  guides(fill=guide_legend(title="Levels of Accent")) +
  coord_cartesian(x = c(0.5, 3.5),
                  y = c(0, 150)) +
  scale_fill_manual(values = c("red", "blue", "gray"))  + 
  facet_grid(~family)
```

* Save plot

```{r boxsave, message=FALSE, warning=FALSE}
ggsave(here::here("images", "myniceggplot.png"))
```


## Line Plots{-}

When you want to create different types of plots (scatter plot, line plot, box plot, bar chart, etc.), you can do this by changing the *geom* as shown below. **You need to be careful though because not all plot types work for all types of variables. For instance, a box plot requires a categorical variable (typically on the x-axis) and a numeric variable (typically a frequency shown on the y-axis).**


Prepare data

```{r line01, message=FALSE, warning=FALSE}
linedat <- myxlsx %>%
  drop_na() %>%
  mutate(age_cat = case_when(age_months < 60 ~ "41-60",
                             age_months < 70 ~ "61-70",
                             age_months < 80 ~ "71-80",
                             age_months < 90 ~ "81-90",
                             age_months < 100 ~ "91-100",
                             age_months < 110 ~ "101-110",
                             age_months < 120 ~ "111-120"),
         age_cat = factor(age_cat, levels = c("41-60", "61-70", "71-80", "81-90", 
                                              "91-100", "101-110", "111-120"))) %>%
  group_by(family, age_cat) %>%
  summarise(accent_numeric = mean(accent_numeric))
```

Generate plot

```{r line02, message=FALSE, warning=FALSE}
linedat  %>%
  ggplot(aes(x = age_cat, y = accent_numeric, 
                   group = family, color = family)) +
  geom_line()
```

Prettify plot

* add different line types
* increase thickness of lines

```{r line03, message=FALSE, warning=FALSE}
linedat %>%
  ggplot(aes(x = age_cat, y = accent_numeric, 
                   group = family, color = family, linetype = family)) +
  geom_line(size = 1.5)
```

* white background
* change axes labels

```{r line04, message=FALSE, warning=FALSE}
linedat %>%
  ggplot(aes(x = age_cat, y = accent_numeric, 
                   group = family, color = family, linetype = family)) +
  geom_line(size = 1.5) +
  theme_bw() +
  labs(x = "Age", y = "Accent strength rating")
```

* legend at top
* change y-axis tick labels

```{r line05, message=FALSE, warning=FALSE}
linedat %>%
  ggplot(aes(x = age_cat, y = accent_numeric, 
                   group = family, color = family, linetype = family)) +
  geom_line(size = 1.5) +
  theme_bw() +
  labs(x = "Age", y = "Accent strength rating") +
  theme(legend.position = "top") +
  scale_y_discrete(name ="Accent strength rating", 
                   limits = seq(0, 2, 1), 
                   labels = c("No accent", "Weak accent", "Strong accent"))
```

* change legend text

```{r line06, message=FALSE, warning=FALSE}
linedat %>%
    mutate(family = case_when(family == "bil-mixed" ~ "Mixed bilingual",
                              family == "bil-rus" ~ "Bilingual Russian",
                              family == "mono-de" ~ "Monolingual German",
                              TRUE ~ family)) %>%
  ggplot(aes(x = age_cat, y = accent_numeric, 
                   group = family, color = family, linetype = family)) +
  geom_line(size = 1.5) +
  theme_bw() +
  labs(x = "Age", y = "Accent strength rating") +
  theme(legend.position = "top") +
  scale_y_discrete(name ="Accent strength rating", 
                   limits = seq(0, 2, 1), 
                   labels = c("No accent", "Weak accent", "Strong accent")) +
    guides(linetype=guide_legend(title="Family type"),
         color=guide_legend(title="Family type"))
```

Save plot

```{r aveline, message=FALSE, warning=FALSE}
ggsave(here::here("images", "niceline.png"))
```


## Smoothed Line Plots{-}

2 numeric variable a or 1 numeric (y) and 1 categorical

Generate basic plot

```{r smooth01, message=FALSE, warning=FALSE}
ggplot(myxlsx, aes(x = age_months, y = accent_numeric, 
                   group = family, color = family, fill = family)) +
  geom_smooth()
```

### Exercise; Prettifying the plot{-}


Based on what you learned before, can you make the plot "nicer"?
Please change the following:

* Axes labels
* Background color
* Line and fill color
* Legend position
* legend title
* y-axis tick labels

The final plot should look sth like this:

```{r smooth02, eval = T, echo = F, message=FALSE, warning=FALSE}
myxlsx %>%
  drop_na() %>%
  mutate(family = case_when(family == "bil-mixed" ~ "Mixed bilingual",
                            family == "bil-rus" ~ "Bilingual Russian",
                            family == "mono-de" ~ "Monolingual German",
                            TRUE ~ family),
         accent_response = factor(accent_response, 
                                  levels = c("no", "w", "s"), 
                                  labels = c("No accent", "Weak accent", "Strong accent"))) %>%
  ggplot(aes(x = age_months, y = accent_numeric, 
                   group = family, color = family, fill = family)) +
  geom_smooth() +
  labs(x = "Age of child\n(in months)") +
  theme_bw() +
  scale_color_manual(values = c("orange", "gray", "lightblue")) +
  scale_fill_manual(values = c("orange", "gray", "lightblue")) +
  theme(legend.position = "top") +
  guides(fill=guide_legend(title="Family type"),
         color=guide_legend(title="Family type")) +
  scale_y_discrete(name ="Accent strength rating", 
                   limits = seq(0, 2, 1), 
                   labels = c("No accent", "Weak accent", "Strong accent"))
ggsave(here::here("images", "nicesmooth.png"))
```



## Bar Chart{-}

One categorical variable.


Generate basic plot

```{r bar01, message=FALSE, warning=FALSE}
ggplot(myxlsx, aes(x = family)) +
  geom_bar(stat = "count")
```

Alternative: show pre-calculated frequencies

Prepare data

```{r bar02, message=FALSE, warning=FALSE}
bardata <- myxlsx %>%
  mutate(family = case_when(family == "bil-mixed" ~ "Mixed bilingual",
                            family == "bil-rus" ~ "Bilingual Russian",
                            family == "mono-de" ~ "Monolingual German",
                            TRUE ~ family)) %>%
  group_by(family) %>%
  summarise(Frequency = n()) %>%
  ungroup() %>%
  mutate(Total = sum(Frequency)) %>%
  rowwise() %>%
  mutate(Percent = round(Frequency/Total *100, 1),
         Label = paste0(Frequency, " (", Percent, "%)")) %>%
  select(-Total)
# check data
bardata
```

1 numeric and 1 categorical variable


```{r bar03, message=FALSE, warning=FALSE}
ggplot(bardata, aes(x = family, y = Frequency)) +
  geom_bar(stat = "identity")
```

Prettify plot

* change background
* modify axes labels
* change color/filling
* remove legend


```{r bar04, message=FALSE, warning=FALSE}
ggplot(bardata, aes(x = family, y = Frequency, fill = family)) +
  geom_bar(stat = "identity") +
  theme_bw() +
  labs(x = "Family Type", y = "Raw Frequency") +
  theme(legend.position = "none")
```

* adapt axis range
* Add text/annotation

```{r bar05, message=FALSE, warning=FALSE}
ggplot(bardata, aes(x = family, y = Frequency, fill = family, label = Label)) +
  geom_bar(stat = "identity") +
  theme_bw() +
  labs(x = "Family Type", y = "Raw Frequency") +
  theme(legend.position = "none") +
  coord_cartesian(ylim = c(0, 500)) +
  geom_text(vjust=-1.5, position = position_dodge(0.9))
```

Save plot

```{r savebar, message=FALSE, warning=FALSE}
ggsave(here::here("images", "nicebar.png"))
```





## Mosaic plots with vcd{-}

It can be really tricky to visualize several categorical variables simultaneously. As this is quite common, we will now learn to generate *mosaic plots*.

To make the best use of a mosaic plot, we need to create a matrix.

* Prepare data: generate matrix

* prepare data: tidy format

```{r mosaic01, message=F, warning=F}
mosaicdat <- myxlsx %>%
  dplyr::group_by(family, age_group, accent_response) %>%
  dplyr::summarise(Frequency = n()) %>%
  dplyr::ungroup() %>%
  dplyr::mutate_if(is.character, factor)
# inspect
mosaicdat
```

* split data

```{r mosaic02, message=F, warning=F}
mos1 <- mosaicdat %>%
  dplyr::filter(family == "bil-mixed") %>%
  dplyr::pull()
mos2 <- mosaicdat %>%
  dplyr::filter(family == "bil-rus") %>%
  dplyr::pull()
mos3 <- mosaicdat %>%
  dplyr::filter(family == "mono-de") %>%
  dplyr::pull()
# inspect
mos1
```

* Generate matrix

```{r mosaic03, message=F, warning=F}
# add dimnames
row.names <- c("no", "s", "w")
column.names <- c("preschool", "school")
matrix.names <- c("bil-mixed", "bil-rus", "mono-de")
# generate matrix
mos_mx <- array(c(mos1, mos2, mos3), 
                dim = c(3, 2, 3),
                dimnames = list(row.names, 
                                column.names,
                                matrix.names))
# inspect
mos_mx
```


* basic mosaic plot

```{r mosaic04, message=F, warning=F}
mosaic(mos_mx,
       shade = TRUE,
       direction = c("h",  "v", "v"),
       just_labels = c("center", "center", "center", "center"))
```

* save mosaic plot

```{r mosaic05, message=F, warning=F}
# open connection
png(here::here("images", "mosaic.png"), width = 750, height = 300)
# generate plot
mosaic(mos_mx,
       axis.cex = 15,
       shade = TRUE,
       direction = c("h",  "v", "v"),
       just_labels = c("center", "center", "center", "center"))
# close window
dev.off() 
```



## Visualizing Likert data{-}

Load data

```{r likert01, message=FALSE, warning=FALSE}
sdat  <- base::readRDS(url("https://slcladal.github.io/data/sdd.rda", "rb"))
# inspect 
head(sdat)
```

* clean column names

```{r likert02, message=FALSE, warning=FALSE}
# clean column names
colnames(sdat)[3:ncol(sdat)] <- paste0("Q ", str_pad(1:10, 2, "left", "0"), ": ", colnames(sdat)[3:ncol(sdat)]) %>%
  stringr::str_replace_all("\\.", " ") %>%
  stringr::str_squish() %>%
  stringr::str_replace_all("$", "?")
# inspect column names
colnames(sdat)
```

* replace numeric values with labels

```{r likert03, message=FALSE, warning=FALSE}
lbs <- c("disagree", "somewhat disagree", "neither agree nor disagree",  
         "somewhat agree", "agree")
survey <- sdat %>%
  dplyr::mutate_if(is.character, factor) %>%
  dplyr::mutate_if(is.numeric, factor, levels = 1:5, labels = lbs) %>%
  drop_na() %>%
  as.data.frame()
# inspect
head(survey)
```


```{r likert04, message=FALSE, warning=FALSE}
plot(likert(survey[,3:12]), ordered = F, wrap= 30)
```

* save plot

```{r likert05, message=FALSE, warning=FALSE}
survey_p1 <- plot(likert(survey[,3:12]), ordered = F, wrap= 60)
# save plot
cowplot::save_plot(here("images", "stu_p1.png"), # where to save the plot
                   survey_p1,        # object to plot
                   base_asp = 1.5,  # ratio of space fro questions vs space for plot
                   base_height = 8) # size! higher for smaller font size
```

* include groups

```{r likert06, message=FALSE, warning=FALSE}
# create plot
survey_p2 <- plot(likert(survey[,3:8], grouping = survey[,1]))
# save plot
cowplot::save_plot(here("images", "stu_p2.png"), # where to save the plot
                   survey_p2,        # object to plot
                   base_asp = 1.5,  # ratio of space fro questions vs space for plot
                   base_height = 8) # size! higher for smaller font size
# show plot
survey_p2
```



# Visualizing Model Effects{-}

Load data

```{r reg01, message=FALSE, warning=FALSE}
regdat <- read.delim(here::here("data", "AJT_V2.csv"), sep = ";")
# inspect data
str(regdat)
```

Perform regression analysis

```{r reg02, message=FALSE, warning=FALSE}
library(lme4)
library(sjPlot)
# run model
m0.glmer = glmer(Response_num ~ (1|ID), data = regdat, family = binomial)
m6.glmer <- update(m0.glmer, .~.+Word_order+Sentence_type+Sentence_type*Group+Sentence_type*Word_order)
# inspect results
sjPlot::tab_model(m6.glmer)
```

Visualize results

```{r reg03, message=FALSE, warning=FALSE}
sjPlot::plot_model(m6.glmer, type = "pred", terms = c("Sentence_type", "Group"))
```

```{r reg04, message=FALSE, warning=FALSE}
sjPlot::plot_model(m6.glmer, type = "pred", terms = c("Sentence_type", "Word_order"))  + 
  ggplot2::theme_bw() +
  ggplot2::labs(x = "Sentence Type", y = "Probability\nfor Response = 1")
```


# Wrap-up{-}



# Citation & Session Info {-}

Schweinberger, Martin. `r format(Sys.time(), '%Y')`. *Introduction to Data Visualization with R - AcqVA Aurora workshop*. Tromsø: The Arctic University of Norway, Tromsø. url: https://slcladal.github.io/introviz.html  (Version `r format(Sys.time(), '%Y.%m.%d')`).

```
@manual{schweinberger`r format(Sys.time(), '%Y')`acqvavizrws,
  author = {Schweinberger, Martin},
  title = {Introduction to Data Visualization with R - AcqVA Aurora workshop},
  note = {https://slcladal.github.io/introviz.html},
  year = {`r format(Sys.time(), '%Y')`},
  organization = "The Arctic University of Norway (UiT), AcqVA Aurora Center},
  address = {Tromsø},
  edition = {`r format(Sys.time(), '%Y.%m.%d')`}
}
```


```{r fin}
sessionInfo()
```

***

[Back to top](#introduction)


***

# References {-}


